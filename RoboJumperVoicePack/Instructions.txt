# $ModSafeName$ - How to edit this mod

This mod template is setup to make it easy to create a voicepack for a single new voice using Robojumper's voice script.

As part of this, it uses specific naming conventions for different parts of the mod - when the instructions tell you to name something in a particular way, generally you must follow them exactly or else the mod will not work. (Quotation marks are NOT part of names.)

This document tries to be very thorough - it's quite wordy in the process. There are some other tutorials given in the Credits section which you might find helpful although they are not as specific to this template. 

This document has the following sections
 - Setting up the package (creating a barebones UPK file to start adding SoundCues and sound files to)
 - Adding your first bark (adding a sound file to the package and hooking it up Robojumper's script via a sound cue)
 - Notes on sound files (what formats are required, etc.)
 - Changing details (gender restrictions, voice name)
 - Credits

# Setting up the package
In XCOM ModBuddy.

1. Menus > BUILD > Build Solution
2. Menus > TOOLS > XCOM 2 Editor

This will open up the Unreal Editor for XCOM2

## Create new UPK package
1. In the Content Browser window, press the "New" button
2. Set the Package name to "$ModSafeName$Pkg"
3. Set the Factory to "SoundCue"
4. Click "OK"

You MUST name the package "$ModSafeName$Pkg".

## Add a reference to the Robojumper Voice Character script
1. Close the Unreal SoundCue Editor window
2. In the Content Browser window select the Actor Classes tab
3. Uncheck 
    "Use 'Actor' as Parent" and 
    "Placeable Classes Only"
4. Search for "RobojumperCharacterVoice_$ModSafeName$"
5. Right-click on RobojumperCharacterVoice_$ModSafeName$ and choose "Create Archetype..."

6. Set the Package name to "$ModSafeName$Pkg"
7. Set the Name to "_$ModSafeName$VoiceArchetype"
8. Click "OK"

You MUST name this object "_$ModSafeName$VoiceArchetype".

## Save the package
1. Go back to the "Content Browser" tab
2. Right-click on SoundCue_0 and choose Delete
3. Press Ctrl-S
4. Click "Yes" in the warning Message that appears about references to external packages
5. Navigate to your mod's content folder
6. Save the package with its default name

(e.g. %USERPROFILE%\Documents\Firaxis ModBuddy\XCOM\$ModSafeName$\$ModSafeName$\Content\$ModSafeName$Pkg.upk - this might not be quite right depending on what you've named stuff when you first created the mod.)

## Add the package to your mod project
1. Close the Content Browser and Unreal Editor windows
2. Return to XCOM ModBuddy
3. In the Solution Explorer pane on the left, right-click the Content folder and choose Add > Existing Item ...
4. Navigate to and Add the "$ModSafeName$Pkg.upk" file

# Adding your first bark

This sections goes through the process of adding a 'Dashing' bark. This the bark played when previewing a voice in the character customisation screen.

You may want to review the "Notes on sound files" section before proceeding.

## Reopen the package
1. Menus > TOOLS > XCOM 2 Editor
2. In the Content Browser window, press the  button with an open folder icon
3. Navigate to and open the "$ModSafeName$Pkg.upk" file

## Importing a sound file
1. In the Content Browser window, press the "Import" button
2. Open your first sound file (e.g. "$ModSafeName$_Dashing_01.wav")
3. Leave the default options and click "OK"

## Creating a sound cue
1. Right-click in the background of the package contents pane and choose "New SoundCue"
2. Set the name to "$ModSafeName$_Dashing_Cue" 

You don't have to use this naming convention for SoundNodeWaves and SoundCues, but I strongly suggest you do so. This keeps SoundNodeWaves and their SoundCues grouped together helpfully when sorting the package contents by name.

3. In the package contents pane, select the SoundNodeWave you added earlier
4. In the Unreal SoundCue Editor, right-click and choose "Random: [...]"
5. Click-and-drag from the black connection point on the right-hand-side of the speaker to the connection point on the left-hand-side of the "Random" node.
6. Close the Unreal SoundCue Editor window.

You can select multiple SoundNodeWaves, and the Random node will pick between them when the cue is triggered.

7. In the package contents pane, right-click on the MGSVRussianDemoVoice_Cue_Dashing object and choose "Sound Classes [...]" > "Voice"

## Hook the cue up to the Voice
1. In the package contents pane, right-click on the Archetype object (_$ModSafeName$VoiceArchetype) and choose Properties
2. Expand the 'Robojumper Character Voice [...]' panel
3. Expand the 'Events' list
4. Find the event with the EventName "Dashing" ([19] as of writing)
5. Expand this event
6. In the package contents pane, select the SoundCue "$ModSafeName$_Cue_Dashing" object
7. In the Archetype properties window, click the green arrow, next to the Cue item under the Dashing event
8. Close the Archetype properties window

## Save the package

1. Press Ctrl-S
2. Click "Yes" in the warning Message that appears about references to external packages

## Testing this bark
1. Close the Content Browser and Unreal Editor windows
2. Return to XCOM ModBuddy
3. Menus > BUILD > Build Solution

4. Start the XCOM 2 launcher
5. Enable your mod
6. Start the game, go to the Character Bank
7. 


# Notes on sound files
Importing sound files into the Unreal Editor logs the filesystem location and import time in the package itself. It's unlikely that this is a major worry for you, but you should be aware that it could leak some information to the rest of the world (e.g. your Windows username).

## Format

Files MUST be 16-bit mono PCM .WAV files with a sample rate of 44100 Hz or 22050 Hz. An example use of ffmpeg might be:

```
ffmpeg -i MyInputFile.mp3 \
-sample_fmt s16 -ar 44100 -ac 1 $ModSafeName$_Dashing_01.wav
```

## Volume

There are several factors that affect how loud the barks actually sound compared to the rest of XCOM 2:
- The volume of the sound file.
- The volume multiplier of the SoundNodeWave object created when you import the sound file; this seems to be fixed at 0.75.
- The volume multiplier of the SoundCue object that plays the SoundNodeWave, which is 0.75 by default by can be changed.
- The sound class of the SoundCue object, which is 'Master' by default but should always be set to 'Voice'.

The sound files for the built-in barks often have an average loudness of about -10 or -11dB (relative to the maximum that PCM can express) with some shouts of pain being a bit louder. Th average volume for these barks then reduced to about -14 or -15dB by the two 0.75 volume multipliers.

I suggest that sensible starting point when creating voice parks is to:
- target an 'integrated loudness' of about -14dB in the sound files, and
- set the volume multiplier of the SoundCue objects to 1.34 (cancelling out the 0.75 SoundNodeWave multiplier).

An example use of ffmpeg might be:

```
ffmpeg -i MyInputFile.mp3 -af "loudnorm=I=-14" \
-sample_fmt s16 -ar 44100 -ac 1 $ModSafeName$_Dashing_01.wav
```

## Radio effect

To add a radio effect (high- and lowpass) in ffmpeg this might be extended to:
```
ffmpeg -i MyInputFile.mp3 -af "highpass=f=150, lowpass=f=10000, loudnorm=I=-14" \
-sample_fmt s16 -ar 44100 -ac 1 $ModSafeName$_Dashing_01.wav

```

Tutorials are available elsewhere on using Audacity to achieve similar results.


For mods adding a single voice, I suggest (for your sanity) a naming scheme for your final sound files like:

```
$ModSafeName$_Dashing_01.wav
$ModSafeName$_Dashing_02.wav
```

# Changing details
To change the name displayed in the XCOM 2 character customisation screen, investigate the \Localisation\XComGame.int file.

To change the gender restrictions, language hints and to enable Spark and WotC classes, investigate the \Config\XComContent.ini file.

# Credits

Robojumper, for the voice script.

## How to create a voice pack
Kregano's guide to using Robojumper's script - https://docs.google.com/document/d/1asHlhTP9tJzyKXIwDALpWdJTVasjh-72blST9kQeai8
E3245's guide to creating voice packs - https://docs.google.com/document/d/1v8jU86Jeqn9wms4Pxjj7f5tHPlmli6TSogrbWvc5vUA
nintendoeat's guide to using UDK tags - https://steamcommunity.com/sharedfiles/filedetails/?id=1336117645

## Audio advice
nintendoeats's guide to processing audio from TV - https://steamcommunity.com/sharedfiles/filedetails/?id=1350627939

## Cue lists
Grouped list with description - https://docs.google.com/spreadsheets/d/1Ndt1bB1830tfy3gz26G779eR36YSutNO2Ugk16BgONE
ObelixDk's list with advice about most common lines - https://pastebin.com/PsSiP4Lt
13y59m's Russian guide - https://steamcommunity.com/sharedfiles/filedetails/?id=881334126&searchtext=visuals
